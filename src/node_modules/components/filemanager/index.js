import React from 'react';
import { createStore, applyMiddleware, combineReducers, compose } from 'redux';
import { Provider } from 'react-redux';
import thunk from 'redux-thunk';
import { FileManagerCore } from './components';
import * as reducers from './store/reducers'

import 'bootstrap/dist/css/bootstrap.css';

const store = createStore(
    combineReducers(reducers),
    compose(applyMiddleware(thunk)), //, window.__REDUX_DEVTOOLS_EXTENSION__ && window.__REDUX_DEVTOOLS_EXTENSION__()
    );

class FileManager extends React.Component {

    constructor(props, context) {
        super(props, context);
        this.state = {
            showFileManager: false
        }
    }

    renderChildren = () => {
        return this.props.children
    }

    setShowFileManager = () =>  {
        this.setState({
            showFileManager: true
        })
    }

    selectFile = (file) => {
        this.setState({
            showFileManager: false
        });
        this.props.onSelect(file)
    }

    renderFileManager = () => {
        if(this.state.showFileManager) {
            return (
                <Provider store={store}>
                    <FileManagerCore selectFile={this.selectFile} auth_url={this.props.auth_url}/>
                </Provider>
            )
        }
        return null;
    }

    render() {
        return (
            <div onClick={this.setShowFileManager}>
                { this.renderFileManager() }
                { this.renderChildren() }
            </div>
        )
    }
}

export default FileManager;