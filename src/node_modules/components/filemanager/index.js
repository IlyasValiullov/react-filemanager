import React from 'react';
import { createStore, applyMiddleware, combineReducers, compose } from 'redux';
import { Provider } from 'react-redux';
import thunk from 'redux-thunk';
import { FileManagerCore } from './components';
import * as reducers from './store/reducers'

import 'bootstrap/dist/css/bootstrap.css';

const store = createStore(
    combineReducers(reducers),
    compose(applyMiddleware(thunk)), //, window.__REDUX_DEVTOOLS_EXTENSION__ && window.__REDUX_DEVTOOLS_EXTENSION__()
    );

class FileManager extends React.Component {

    constructor(props, context) {
        super(props, context);
        this.state = {
            showFileManager: false
        }
    }

    renderChildren = () => {
        return this.props.children
    }

    setShowFileManager = (e) =>  {
        console.log(e);
        console.log('setShowFileManager', true);
        this.setState({
            showFileManager: true
        })
    }

    selectFile = (file) => {
        console.log("file selected");
        this.setState({
            showFileManager: false
        });
        console.log("change state");
        this.props.onSelect(file)
    }

    close = () => {
        console.log("close");
        this.setState({
            showFileManager: false
        })
    }

    renderFileManager = () => {
        return (
                <Provider store={store}>
                    <FileManagerCore selectFile={this.selectFile} closeFileManager={this.close}auth_url={this.props.auth_url}/>
                </Provider>
            );
    }

    render() {
        console.log("render filemanager", this.state.showFileManager);
        return (
            <div >
                { this.state.showFileManager ? this.renderFileManager() : null }
                <div onClick={this.setShowFileManager}>
                    { this.renderChildren() }
                </div>
            </div>
        )
    }
}

export default FileManager;